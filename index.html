<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b0b0c" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Alliteration Animal Namer — v33</title>
  <style>
    :root{
      --bg:#0b0b0c; --card:#151518; --text:#f6f7fb; --muted:#a9adc1; --ring:#3b82f6;
      --red:#ef4444; --green:#10b981; --blue:#3b82f6; --accent:#6ee7ff;
      --play:#16a34a; --playGlow:#22c55e;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0b0b0c,#111217 40%,#0b0b0c);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;min-height:100dvh}
    .wrap{max-width:980px;margin:0 auto;padding:8px 16px 340px}

    /* Sticky banner prompt at the very top (takes 50% height) */
    .banner{position:sticky;top:0;z-index:120;background:#0b0b0c;box-shadow:0 6px 16px rgba(0,0,0,.35);border-bottom:1px solid #23242d}
    .banner .output{margin:8px 0 0;padding:18px 12px;border-radius:12px;background:#0f1117;border:1px solid #2a2e3d;font-size:clamp(56px,9vw,120px);line-height:1.12;cursor:pointer;user-select:none;min-height:50vh;display:flex;align-items:center}
    .emo{color:var(--red);font-weight:900;text-transform:none}
    .animal{color:var(--green);font-weight:900}
    .name{color:var(--blue);font-weight:900}

    .card{background:var(--card);border:1px solid #23242d;border-radius:20px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}

    .btn{appearance:none;border:1px solid #2a2f3d;background:#121420;color:#fff;padding:12px 16px;border-radius:12px;font-weight:800;cursor:pointer;transition:background .2s,border-color .2s,box-shadow .2s}
    .btn.small{padding:8px 10px;font-size:12px}
    .btn.icon{padding:10px 12px;display:inline-flex;align-items:center;justify-content:center;gap:6px}
    .btn:active{transform:translateY(1px)}
    .btn.active{background:linear-gradient(135deg,var(--play),var(--playGlow));border-color:transparent;box-shadow:0 0 0 3px rgba(34,197,94,.25)}

    /* Bottom sheet */
    .sheet{position:fixed;left:0;right:0;bottom:-100%;background:#0f1117;border-top-left-radius:16px;border-top-right-radius:16px;border:1px solid #262a36;box-shadow:0 -20px 30px rgba(0,0,0,.45);transition:bottom .25s ease;z-index:110}
    .sheet.open{bottom:0}
    .sheet .handle{width:54px;height:6px;background:#2a2f3d;border-radius:10px;margin:10px auto}
    .sheet .tabs{display:flex;gap:8px;justify-content:center;margin:8px 0;flex-wrap:wrap}
    .tab{padding:6px 10px;border-radius:999px;border:1px solid #2a2f3d;background:#15171f;color:#fff;font-weight:700;cursor:pointer}
    .navFlip{display:flex;gap:8px;justify-content:center;margin:0 0 8px}
    .pages{display:flex;transition:transform .25s ease}
    .page{min-width:100vw;max-width:100vw;padding:12px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px;max-height:46vh;overflow:auto;padding-right:4px}

    /* Startup signature splash */
    .splash{position:fixed;left:0;right:0;bottom:12px;display:flex;justify-content:center;z-index:200;transition:opacity .6s ease, transform .6s ease}
    .splash .pill{background:#151518;border:1px solid #2a2e3d;color:#a9adc1;padding:10px 14px;border-radius:999px;box-shadow:0 8px 20px rgba(0,0,0,.45)}
    .splash.hide{opacity:0;pointer-events:none;transform:translateY(10px)}

    /* Focus (enlarged) mode */
    body.focus .sheet, body.focus .footer, body.focus .topbar, body.focus .bottomArea{ display:none !important; }
    body.focus .banner{ box-shadow:none; border-bottom:none; }
    body.focus .banner .output{ font-size:clamp(64px,12vw,160px); padding:28px 16px; }
    body.focus .emo, body.focus .animal, body.focus .name{ display:block; text-align:left; }
    @media (orientation:landscape){ body.focus .emo, body.focus .animal, body.focus .name{ display:inline; text-align:left; } body.focus .banner .output{ text-align:left; } }

    /* Focus controls overlay */
    .focusControls{position:fixed;left:14px;right:14px;bottom:14px;z-index:130;display:none;gap:10px}
    body.focus .focusControls{display:grid;grid-template-columns:repeat(3,minmax(120px,1fr));grid-auto-rows:auto}
    .focusControls .btn{padding:10px 12px;font-size:14px}

    /* Fixed bottom area (search + all buttons + brand) */
    .bottomArea{position:fixed;left:14px;right:14px;bottom:14px;z-index:115;display:grid;gap:10px}
    .searchFixed{position:relative}
    .searchFixed input{width:100%;padding:14px 16px;border-radius:14px;border:1px solid #272a36;background:#0f1117;color:var(--text);font-size:18px;outline:none;transition:border .18s, box-shadow .18s}
    .searchFixed input:focus{border-color:var(--ring);box-shadow:0 0 0 4px rgba(59,130,246,.25)}
    .suggestions{position:relative;margin-top:8px}
    .suggestions ul{position:absolute;z-index:40;list-style:none;margin:0;padding:6px;background:#0f1117;border:1px solid #262a36;border-radius:12px;width:100%;max-height:260px;overflow:auto;box-shadow:0 20px 30px rgba(0,0,0,.35)}
    .suggestions li{padding:10px 12px;border-radius:10px;cursor:pointer}
    .suggestions li[aria-selected="true"], .suggestions li:hover{background:#1a1f2b}

    .mainDock{display:grid;gap:10px;grid-template-columns:repeat(3,minmax(120px,1fr))}
    .mainDock .btn{padding:10px 12px;font-size:14px}
    .brand{color:#a9adc1;text-align:center;font-size:12px}

    /* Definitions page */
    .defs{position:fixed;inset:0;background:#0c0e14;z-index:140;display:none}
    .defs.open{display:block}
    .defsContent{padding:12px 16px 120px;display:grid;gap:16px}
    .defCard{background:#10131b;border:1px solid #262a36;border-radius:16px;padding:18px}
    .defCard .label{font-weight:900;margin-bottom:6px;font-size:32px}
    .defCard .def{color:#c9cedd;font-size:16px;line-height:1.45;text-transform:lowercase}
    .defsBottom{position:fixed;left:0;right:0;bottom:0;background:#0f1117;border-top:1px solid #262a36;padding:10px 12px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap}

    .footer{margin:28px 2px 12px;color:var(--muted);font-size:12px}

    /* Hide mode */
    body.hide #searchField{display:none}
    body.hide #mainDock .primary{display:none}
  </style>
</head>
<body>
  <div class="wrap" id="appArea">
    <!-- Sticky Prompt Banner at the very top -->
    <div class="banner">
      <div class="output" id="result" title="Tap/click for NEW letter phrase (Enter on PC)">Your phrase will appear here…</div>
    </div>

    <!-- Focus-mode overlay controls -->
    <div class="focusControls" id="focusControls">
      <button class="btn" id="focusPlayBtn" title="Play / Stop">Stop</button>
      <button class="btn" id="focusAudioBtn" title="Audio on/off">Audio</button>
      <button class="btn" id="focusAlphaBtn" title="Toggle ABC next">ABC</button>
      <button class="btn" id="focusDefsBtn" title="Open definitions">Defs</button>
      <button class="btn" id="minimizeBtn" title="Exit enlarged view">Minimize</button>
    </div>

    <p class="footer">Tap/Enter for a phrase with a <em>different</em> starting letter. Phonetics honors “ee” vs “eye”.</p>
  </div>

  <!-- Bottom sheet: list-only pages with fast flip -->
  <div class="sheet" id="sheet">
    <div class="handle"></div>
    <div class="tabs">
      <button class="tab" data-ix="0">A–E</button>
      <button class="tab" data-ix="1">F–J</button>
      <button class="tab" data-ix="2">K–O</button>
      <button class="tab" data-ix="3">P–Z</button>
      <button class="tab" id="closeSheet">Close</button>
    </div>
    <div class="navFlip">
      <button class="btn small" id="flipPrev">‹ Prev</button>
      <button class="btn small" id="flipNext">Next ›</button>
    </div>
    <div class="pages" id="pages">
      <div class="page"><div class="grid" id="grid12"></div></div>
      <div class="page"><div class="grid" id="gridFJ"></div></div>
      <div class="page"><div class="grid" id="gridKO"></div></div>
      <div class="page"><div class="grid" id="gridPZ"></div></div>
    </div>
  </div>

  <!-- Settings Sheet (Close on the left) -->
  <div class="sheet" id="settings" style="padding-bottom:20px">
    <div class="handle"></div>
    <div style="display:flex;align-items:center;justify-content:space-between;padding:6px 12px;position:sticky;top:0;background:#0f1117;z-index:5;border-bottom:1px solid #262a36">
      <button class="btn small" id="settingsCloseTop">Close</button>
      <span class="row" style="gap:8px"><strong style="color:#a9adc1">Settings</strong></span>
      <span></span>
    </div>
    <div style="padding:12px 16px;display:grid;gap:16px">
      <section>
        <h3 style="margin:0 0 8px">Word groups shown</h3>
        <div class="row" style="gap:12px;flex-wrap:wrap">
          <label class="toggle"><input type="checkbox" id="chkEmotion" checked /> Emotion</label>
          <label class="toggle"><input type="checkbox" id="chkChem" checked /> Chemistry</label>
          <label class="toggle"><input type="checkbox" id="chkMove" checked /> Movement</label>
          <label class="toggle"><input type="checkbox" id="chkAnimal" checked /> Animal</label>
          <label class="toggle"><input type="checkbox" id="chkName" checked /> Name</label>
        </div>
        <div class="row" style="gap:12px;margin-top:8px">
          <label class="toggle"><input type="checkbox" id="phoneticToggle" checked /> Phonetic alliteration (same starting sound)</label>
        </div>
        <div class="row" style="gap:12px;margin-top:8px">
          <label class="toggle"><input type="checkbox" id="chkIndian" checked /> Include Indian names</label>
        </div>
      </section>

      <section>
        <h3 style="margin:0 0 8px">Delay function (staged reveal)</h3>
        <div class="row" style="gap:12px;align-items:center">
          <label class="toggle"><input type="checkbox" id="delayToggle" checked /> Enable</label>
          <span style="color:var(--muted);font-size:12px">Default: <strong>3s</strong> between words; <strong>9s</strong> first→first.</span>
        </div>
        <div class="row" style="gap:24px;flex-wrap:wrap;margin-top:8px">
          <div>
            <div style="font-weight:700;margin-bottom:6px">Between each word</div>
            <div class="row" style="gap:6px">
              <button class="btn small setWordGap" data-v="1">1s</button>
              <button class="btn small setWordGap" data-v="2">2s</button>
              <button class="btn small setWordGap" data-v="3">3s</button>
              <button class="btn small setWordGap" data-v="4">4s</button>
              <button class="btn small setWordGap" data-v="5">5s</button>
              <button class="btn small setWordGap" data-v="6">6s</button>
            </div>
          </div>
          <div>
            <div style="font-weight:700;margin-bottom:6px">First → next First (whole phrase cadence)</div>
            <div class="row" style="gap:6px">
              <button class="btn small setSeg" data-v="2">2s</button>
              <button class="btn small setSeg" data-v="3">3s</button>
              <button class="btn small setSeg" data-v="6">6s</button>
              <button class="btn small setSeg" data-v="9">9s</button>
              <button class="btn small setSeg" data-v="12">12s</button>
              <button class="btn small setSeg" data-v="15">15s</button>
              <button class="btn small setSeg" data-v="18">18s</button>
              <button class="btn small setSeg" data-v="20">20s</button>
              <button class="btn small setSeg" data-v="30">30s</button>
              <button class="btn small setSeg" data-v="40">40s</button>
            </div>
          </div>
        </div>
        <p style="margin:8px 0 0; color:var(--muted); font-size:12px">Example: 3s between words + 9s first→first ⇒ 3s (w1→w2), 3s (w2→w3), then 3s (w3→next w1).</p>
      </section>

      <section>
        <h3 style="margin:0 0 8px">Time between prompts (Delay OFF)</h3>
        <div class="row" style="gap:8px;flex-wrap:wrap">
          <button class="btn small setGap" data-gap="3">3s</button>
          <button class="btn small setGap" data-gap="5">5s</button>
          <button class="btn small setGap" data-gap="10">10s</button>
          <button class="btn small setGap" data-gap="15">15s</button>
          <button class="btn small setGap" data-gap="20">20s</button>
          <button class="btn small setGap" data-gap="30">30s</button>
          <button class="btn small setGap" data-gap="40">40s</button>
          <button class="btn small setGap" data-gap="50">50s</button>
        </div>
      </section>
    </div>
  </div>

  <!-- Startup splash (shows for 2.5s then fades) -->
  <div class="splash" id="splash"><div class="pill">Jimmy James 25.09.2025 - v33</div></div>

  <!-- Definitions overlay (word, animal, and name) -->
  <div class="defs" id="defs">
    <div class="defsContent" id="defsContent">
      <div class="defCard">
        <div class="label emo" id="defWordLbl">word</div>
        <div class="def" id="defWordTxt">definition here…</div>
      </div>
      <div class="defCard">
        <div class="label animal" id="defAnimalLbl">animal</div>
        <div class="def" id="defAnimalTxt">definition here…</div>
      </div>
      <div class="defCard">
        <div class="label name" id="defNameLbl">name</div>
        <div class="def" id="defNameTxt">a personal name.</div>
      </div>
    </div>
    <div class="defsBottom">
      <button class="btn" id="defsBack">← Back</button>
      <button class="btn" id="defsPlayBtn">Play</button>
      <button class="btn" id="defsEnlargeBtn">Enlarge</button>
      <button class="btn" id="defsAlphaBtn">ABC</button>
    </div>
  </div>

  <!-- Fixed bottom area: search + all actions + brand -->
  <div class="bottomArea" id="bottomArea">
    <div class="searchFixed" id="searchField">
      <input id="page1Search" type="text" placeholder="Type a prefix. ↑/↓ navigate, Enter select. ← prev • → next • Enter = NEW letter" autocomplete="off" />
      <div class="suggestions" id="p1Suggest"></div>
    </div>
    <div class="mainDock" id="mainDock">
      <button class="btn" id="playBtn" title="Play / Stop" aria-label="Play">Play</button>
      <button class="btn" id="audioBtn" title="Audio on/off" aria-label="Audio">Audio</button>
      <button class="btn" id="settingsBtn" title="Settings" aria-label="Settings">Settings</button>

      <button class="btn primary" id="mainNewPhrase">New phrase</button>
      <button class="btn primary" id="mainNewAnimal">New animal</button>
      <button class="btn primary" id="mainNewName">New name</button>

      <button class="btn" id="mainOpenPages">Open pages</button>
      <button class="btn" id="mainEnlarge">Enlarge</button>
      <button class="btn" id="mainDefs">Definitions</button>

      <!-- NEW toggle buttons (replacing top checkboxes) -->
      <button class="btn" id="btnABC">ABC</button>
      <button class="btn active" id="btnAdv">adv.</button>
      <button class="btn" id="btnHide">hide</button>
    </div>
    <div class="brand">Alliteration Animal Namer — v33</div>
  </div>

  <!-- Hidden state inputs preserved for logic -->
  <input type="checkbox" id="alphaToggle" style="display:none" />
  <input type="checkbox" id="advToggle" style="display:none" checked />
  <input type="checkbox" id="hideToggle" style="display:none" />

  <script>
    // ==== DATA (unchanged from v32) ========================================
    const animalsByLetter = {
      a:['ant','aardvark','albatross','anole','auk','axolotl'],
      b:['bear','beaver','buffalo','baboon','bluebird','boar'],
      c:['cheetah','cougar','capybara','cobra','crab','crow'],
      d:['dog','deer','dolphin','duck','donkey','dragonfly'],
      e:['eagle','emu','eel','elephant','egret','echidna'],
      f:['fox','frog','falcon','ferret','flamingo','firefly'],
      g:['giraffe','goat','goose','gecko','gorilla','goldfish'],
      h:['horse','hamster','heron','hyena','hedgehog','hawk'],
      i:['iguana','impala','ibis','inchworm','isopod','irish setter'],
      j:['jaguar','jellyfish','jackal','jay','jerboa','joey'],
      k:['koala','kangaroo','kingfisher','kestrel','kiwi','komodo'],
      l:['lion','lemur','lobster','llama','lynx','lark'],
      m:['monkey','moose','magpie','macaw','marmot','mantis'],
      n:['narwhal','newt','nightingale','nighthawk','nudibranch','nene'],
      o:['owl','otter','ocelot','oriole','orangutan','ox'],
      p:['penguin','panda','panther','parrot','puffin','porpoise'],
      q:['quail','quetzal','quokka','queen bee','quoll','quagga'],
      r:['rabbit','raccoon','ram','raven','robin','reindeer'],
      s:['seal','sparrow','shark','swan','serval','skunk'],
      t:['tiger','turkey','toucan','tortoise','tapir','tarantula'],
      u:['urchin','uakari','urial','uguisu','umbrella bird','unicornfish'],
      v:['viper','vulture','vicuna','vole','vaquita','veery'],
      w:['wolf','walrus','wren','weasel','whale','wombat'],
      x:['x-ray tetra','xerus','xenops','xoloitzcuintli','xenopus','xantus hummingbird'],
      y:['yak','yellowtail','yabby','yapok','yellowhammer','yakutian laika'],
      z:['zebra','zorilla','zebu','zander','zooplankter','zipper fish'],
    };

    const namesBaseByLetter = {
      a:['Alex','Anjitha','Aree','Amelia','Arnold','Ava'],
      b:['Barry','Bella','Brian','Beatrice','Bruno','Bianca'],
      c:['Charlie','Claire','Carlos','Caroline','Cynthia','Cedric'],
      d:['Daisy','Daniel','Derek','Delilah','Diego','Daphne'],
      e:['Ella','Edward','Eve','Elijah','Emilia','Ethan'],
      f:['Felix','Fiona','Frank','Faith','Freya','Floyd'],
      g:['George','Geetha','Grace','Gabriel','Gavin','Giselle'],
      h:['Hank','Hannah','Harry','Hazel','Helen','Hugo'],
      i:['Isla','Isaac','India','Ivan','Ivy','Ines'],
      j:['Jasper','Julie','Jordan','June','Jonah','James','Jim','Jimmy'],
      k:['Katie','Kevin','Kira','Khalid','Kyle','Kara'],
      l:['Leo','Luna','Liam','Layla','Logan','Lorenzo'],
      m:['Max','Mia','Mason','Maya','Miles','Maggie'],
      n:['Nora','Noah','Naomi','Nelson','Natalie','Nate'],
      o:['Oliver','Olivia','Oscar','Opal','Owen','Orla'],
      p:['Piper','Paul','Penelope','Phoebe','Peter','Pravin'],
      q:['Quinn','Quentin','Queen','Quincy','Quiana','Quade'],
      r:['Ruby','Ryan','Rachel','Rafael','Riley','Remi'],
      s:['Sally','Sam','Santiago','Sophia','Sarachandra','Simon','Shabana','Shayla'],
      t:['Tony','Tina','Thomas','Talia','Trevor','Tracy'],
      u:['Uma','Ulysses','Ursula','Ugne','Ulric','Umi'],
      v:['Violet','Victor','Vanessa','Valentina','Vikram','Vince'],
      w:['Wendy','Will','Willow','Wesley','Wanda','Winston'],
      x:['Xavier','Xena','Ximena','Xander','Xia','Xaviera'],
      y:['Yara','Yosef','Yasmin','Yuki','Yolanda','Yuri'],
      z:['Zoe','Zach','Zara','Zeke','Zelda','Zane'],
    };

    const keralaNamesByLetter = {
      a:['Anoop','Anil','Anitha','Anju'], b:['Binu','Biju','Beena','Bindhu'], c:['Chacko','Celine','Chitra','Cyril'],
      d:['Deepa','Divya','Dileep','Deepak'], e:['Ebin','Edwin','Esha','Emil'], f:['Fathima','Faisal','Fida','Femi'],
      g:['Gireesh','Geetha','Goutham','Greeshma'], h:['Hari','Harish','Hema','Haritha'], i:['Indu','Indira','Ijas','Irfan'],
      j:['Jithin','Jisha','Jincy','Jobin'], k:['Kiran','Kavya','Keerthi','Karthik'], l:['Lijo','Liji','Laya','Lekha'],
      m:['Manu','Manoj','Meera','Midhun'], n:['Nisha','Nithin','Nithya','Neha'], o:['Omana','Oommen','Ouseph','Oviya'],
      p:['Praveen','Pranav','Priya','Poornima'], q:['Qadir','Qamar','Qais','Qadira'], r:['Ramesh','Rajesh','Reshma','Riya'],
      s:['Sajith','Shaji','Sreya','Sruthi'], t:['Thomas','Thomson','Thara','Tina'], u:['Unni','Unnikrishnan','Usha','Uma'],
      v:['Vijay','Vinod','Vidya','Veena'], w:['Wilson','William','Warren','Winnie'], x:['Xavier','Xavi','Xaviera','Xyla'],
      y:['Yadhu','Yaseen','Yamini','Yohan'], z:['Zain','Ziyad','Zareena','Zahra'],
    };

    const emotionList = [
      'afraid','agitated','aloof','amused','angry','annoyed','anxious','ashamed','astonished','awkward','baffled','bitter','blissful','bold','brave','calm','cheerful','confident','confused','content','cranky','curious','defiant','delighted','depressed','determined','disgusted','dismayed','eager','ecstatic','embarrassed','envious','excited','fearful','frustrated','giddy','gloomy','grateful','grumpy','guilty','happy','hopeful','hostile','impatient','insecure','irritated','joyful','lonely','melancholy','nervous','optimistic','overwhelmed','peaceful','proud','relieved','resentful','restless','satisfied','scared','serene','shocked','shy','silly','sorrowful','startled','stressed','tense','tired','tranquil','upbeat','wistful','zealous'
    ];
    const movementList = [
      'arching','basking','bending','bouncy','bounding','breathing','bursting','crawling','choppy','contracting','circling','coiling','creeping','darting','dragging','drooping','expanding','fast','floating','flowing','fluttering','galloping','gliding','hopping','heavy','jerky','leaping','light','lunging','marching','pirouetting','pulsing','quivering','rigid','rolling','rocking','sprinting','sauntering','shuffling','skipping','slithering','spiraling','staggering','stomping','striding','swaying','swinging','tilting','tiptoeing','trembling','twisting','undulating','vibrating','wobbling','zigzagging'
    ];
    const extraList = ['bad','brisk','bright','bouncy','bold','soft','strong','swift','sturdy','spry','sleepy','soggy','silky','harmful','haphazardful'];

    const chemistryListFull = [
      'acidic','activated','aerobic','alkaline','allotropic','amphoteric','aqueous','atomic','basic','binding','biochemical','boiling','bonded','buffered','buoyant','catalytic','charged','chemical','colloidal','conductive','crystalline','covalent','diffusive','dilute','dimeric','dynamic','electrolytic','endothermic','enzymatic','equilibrated','exothermic','ferrous','ferric','fluorescent','fluid','fusion','gaseous','galvanic','geometric','glycolytic','hydrophilic','hydrophobic','hypertonic','hypotonic','ionic','isomeric','isotopic','isotonic','joule-rich','junctional','kinetic','lattice','luminescent','liquid','malleable','metallic','molar','molecular','magnetic','neutral','nucleophilic','nonpolar','oxidative','osmotic','organic','paramagnetic','photonic','polar','polymeric','precipitated','quantized','quaternary','radioactive','reactive','reductive','resonant','saturated','stoichiometric','supersaturated','synthetic','soluble','solvent','titrated','thermal','turbulent','tensile','unsaturated','uniform','valent','volatile','viscous','weakly-bound','wavelike','wettable','xenon-like','xeric','yielding','ytterbic','zeta-potential','zwitterionic'
    ];

    const chemDefs = { 'acidic':'having properties of an acid; ph < 7; donates protons.', 'alkaline':'basic; ph > 7; rich in hydroxide ions.', 'amphoteric':'can act as either an acid or a base.', 'aqueous':'dissolved in water.', 'catalytic':'increases reaction rate without being consumed.', 'covalent':'shared electron pairs.', 'endothermic':'absorbing heat.', 'exothermic':'releasing heat.', 'fluorescent':'emitting light after excitation.', 'hydrophilic':'water-attracting.', 'hydrophobic':'water-repelling.', 'ionic':'involving ions.', 'isomeric':'same formula, different arrangement.', 'isotopic':'relating to isotopes.', 'magnetic':'exhibiting magnetism.', 'neutral':'ph ~7 or no net charge.', 'nonpolar':'little charge separation.', 'organic':'carbon-based.', 'polar':'uneven charge distribution.', 'reactive':'readily undergoes chemical change.', 'reductive':'involving reduction.', 'saturated':'at solubility limit or only single c–c bonds.', 'soluble':'capable of dissolving.', 'solvent':'medium that dissolves solutes.', 'thermal':'relating to heat.', 'turbulent':'chaotic fluid flow.', 'unsaturated':'below solubility limit or has c=c/c≡c bonds.', 'uniform':'evenly distributed.', 'volatile':'evaporates readily.' };

    const animalDefs = { 'bear':'a large omnivorous mammal (ursidae).','seal':'a fin-footed marine mammal (pinniped).','tiger':'a striped big cat of asia.','jaguar':'a powerful spotted big cat of the americas.','giraffe':'the tallest land animal with a long neck.','wolf':'a social wild canid.','eagle':'a large bird of prey.','otter':'a playful semi-aquatic mammal.','ant':'a social insect known for colonies.' };

    // ==== ELEMENTS & STATE ================================================
    const result = document.getElementById('result');

    // Bottom controls
    const playBtn = document.getElementById('playBtn');
    const audioBtn = document.getElementById('audioBtn');
    const settingsBtn = document.getElementById('settingsBtn');

    const openSheetBtn = document.getElementById('mainOpenPages');
    const enlargeBtn = document.getElementById('mainEnlarge');
    const defsBtn = document.getElementById('mainDefs');

    const mainNewPhrase = document.getElementById('mainNewPhrase');
    const mainNewAnimal = document.getElementById('mainNewAnimal');
    const mainNewName   = document.getElementById('mainNewName');

    // Hidden state checkboxes for logic
    const alphaToggle = document.getElementById('alphaToggle');
    const advToggle = document.getElementById('advToggle');
    const hideToggle = document.getElementById('hideToggle');

    const sheet = document.getElementById('sheet');
    const pages = document.getElementById('pages');
    const tabs = document.querySelectorAll('.tab[data-ix]');
    const closeSheetBtn = document.getElementById('closeSheet');
    const flipPrev = document.getElementById('flipPrev');
    const flipNext = document.getElementById('flipNext');

    const grid12 = document.getElementById('grid12');
    const gridFJ = document.getElementById('gridFJ');
    const gridKO = document.getElementById('gridKO');
    const gridPZ = document.getElementById('gridPZ');

    const splash = document.getElementById('splash');

    // Settings controls
    const chkEmotion = document.getElementById('chkEmotion');
    const chkChem = document.getElementById('chkChem');
    const chkMove = document.getElementById('chkMove');
    const chkAnimal = document.getElementById('chkAnimal');
    const chkName = document.getElementById('chkName');
    const chkIndian = document.getElementById('chkIndian');
    const phoneticToggle = document.getElementById('phoneticToggle');
    const delayToggle = document.getElementById('delayToggle');

    // Toggle buttons
    const btnABC = document.getElementById('btnABC');
    const btnAdv = document.getElementById('btnAdv');
    const btnHide = document.getElementById('btnHide');

    // Definitions overlay elements
    const defs = document.getElementById('defs');
    const defsBack = document.getElementById('defsBack');
    const defsContent = document.getElementById('defsContent');
    const defWordLbl = document.getElementById('defWordLbl');
    const defWordTxt = document.getElementById('defWordTxt');
    const defAnimalLbl = document.getElementById('defAnimalLbl');
    const defAnimalTxt = document.getElementById('defAnimalTxt');
    const defNameLbl = document.getElementById('defNameLbl');
    const defNameTxt = document.getElementById('defNameTxt');
    const defsPlayBtn = document.getElementById('defsPlayBtn');
    const defsEnlargeBtn = document.getElementById('defsEnlargeBtn');
    const defsAlphaBtn = document.getElementById('defsAlphaBtn');

    // Page 1 typing/suggestions state
    const p1Search = document.getElementById('page1Search');
    const p1Suggest = document.getElementById('p1Suggest');
    let p1List = []; let p1Index = -1;

    // Playback & timing
    let playing=true; let timer=null; let gapSec=5; // used when Delay OFF
    let segSec=9; let wordDelay=3; // defaults
    let audioOn=false; let phoneticOn=true; let indianOn=true;

    // Helpers
    const cap = s => s ? s[0].toUpperCase()+s.slice(1) : s;
    const rand = arr => arr[Math.floor(Math.random()*arr.length)];
    const letters = 'abcdefghijklmnopqrstuvwxyz'.split('');
    const nextLetter = l => letters[(letters.indexOf(l)+1+26)%26]||'a';
    const prevLetter = l => letters[(letters.indexOf(l)-1+26)%26]||'z';

    const animalsAll = Object.values(animalsByLetter).flat();
    function getNamesForLetter(l){ return [ ...(namesBaseByLetter[l]||[]), ...(indianOn ? (keralaNamesByLetter[l]||[]) : []) ]; }
    function getNamesAll(){ return letters.flatMap(l=> getNamesForLetter(l)); }

    function initialPhoneme(w){
      const s=(w||'').toLowerCase(); if(!s) return '';
      if(s.startsWith('ph')) return 'f'; if(s.startsWith('sh')) return 'sh'; if(s.startsWith('ch')) return 'ch'; if(s.startsWith('th')) return 'th';
      if(s.startsWith('kn')||s.startsWith('gn')||s.startsWith('pn')) return 'n'; if(s.startsWith('wr')) return 'r'; if(s.startsWith('wh')) return 'w';
      if(s.startsWith('ps')) return 's'; if(s.startsWith('qu')) return 'k'; if(s.startsWith('eye')) return 'eye';
      if(/^i(sland|sle|phone|pad|pod|watch)/.test(s)) return 'eye';
      if(/^e(agle|el|erie|vil|qual|gret)/.test(s)) return 'ee';
      if(/^uni|^ut|^use|^user/.test(s)) return 'y'; if(/^ur/.test(s)) return 'ur';
      const hardGExceptions = ['giddy','gift','gifts','give','given','giver','giving','girl','girly','gird','girth','gill','gila','gizmo','get','gets','gecko','gear','geared','gearing','ghetto','ghee','guitar','guy','guys'];
      if(hardGExceptions.some(x=> s.startsWith(x))) return 'g';
      const c=s[0]; const n=s[1]||''; if(c==='c') return 'eiy'.includes(n) ? 's' : 'k'; if(c==='g') return 'eiy'.includes(n) ? 'j' : 'g'; if(c==='x') return 'z'; if(c==='q') return 'k';
      return c;
    }

    function getActiveFirstWordList(){
      let arr=[]; if(chkEmotion.checked){ arr = arr.concat(emotionList, extraList); }
      if(chkMove.checked){ arr = arr.concat(movementList); }
      if(chkChem.checked){ arr = arr.concat(chemistryListFull); }
      if(!arr.length) arr = emotionList.slice();
      return Array.from(new Set(arr)).sort((a,b)=>a.localeCompare(b));
    }

    function speak(text){ try{ if(!audioOn || !('speechSynthesis' in window)) return; const u = new SpeechSynthesisUtterance(text); u.rate = 0.7; window.speechSynthesis.speak(u);}catch(e){} }

    let t2=null, t3=null; // staged timers (prompt)
    let d2=null, d3=null; // staged timers (definitions)

    // ======= RENDER =========================================================
    let current = { word: 'breathing', letter: 'b', animal: 'bear', name: 'Barry' };
    function render(word, opts={}){
      [t2,t3].forEach(t=> clearTimeout(t)); if('speechSynthesis' in window) window.speechSynthesis.cancel();
      const wRaw = (word||current.word); const w = wRaw.toLowerCase(); const firstLetter = w[0]||current.letter||'a'; const phon = initialPhoneme(w);

      if(!opts.keepAnimal){ let pool = phoneticOn ? animalsAll.filter(a=> initialPhoneme(a)===phon) : (animalsByLetter[firstLetter]||[]); if(!pool.length) pool = animalsByLetter[firstLetter]||[]; let choice = rand(pool); if(choice===current.animal && pool.length>1){ choice = pool[(pool.indexOf(choice)+1)%pool.length]; } current.animal = choice; }
      if(!opts.keepName){ let byLetter = getNamesForLetter(firstLetter); let pool = phoneticOn ? getNamesAll().filter(n=> initialPhoneme(n)===phon) : byLetter; if(!pool.length) pool = byLetter; let choice = cap(rand(pool)); if(choice===current.name && pool.length>1){ choice = cap(pool[(pool.indexOf(choice)+1)%pool.length]); } current.name = choice; }

      current.word = w; current.letter = firstLetter;

      const showAnimal = chkAnimal.checked; const showName = chkName.checked;

      if(delayToggle.checked){
        result.innerHTML = `<span class="emo">${w}</span>`; speak(w);
        if(showAnimal){ t2 = setTimeout(()=>{ result.innerHTML = `<span class=\"emo\">${w}</span> <span class=\"animal\">${current.animal}</span>`; speak(current.animal); if(defs.classList.contains('open')) startDefsSequence(); }, wordDelay*1000); }
        if(showName){ const mul = showAnimal ? 2 : 1; t3 = setTimeout(()=>{ result.innerHTML = `<span class=\"emo\">${w}</span>${showAnimal?` <span class=\"animal\">${current.animal}</span>`:''} <span class=\"name\">${current.name}</span>`; speak(current.name); if(defs.classList.contains('open')) startDefsSequence(); }, mul*wordDelay*1000); }
      } else {
        const html = `<span class=\"emo\">${w}</span>${showAnimal?` <span class=\"animal\">${current.animal}</span>`:''}${showName?` <span class=\"name\">${current.name}</span>`:''}`; result.innerHTML = html; speak(`${w} ${showAnimal?current.animal:''} ${showName?current.name:''}`.trim());
      }

      if(defs.classList.contains('open')) { updateDefs(); startDefsSequence(); }
    }

    // ======= LETTER / PHRASE ===============================================
    function pickWordForLetter(l){ const activeWords=getActiveFirstWordList(); const list=activeWords.filter(w=>w.startsWith(l)); return list.length?rand(list):null; }
    function newPhraseAlpha(step=1){ let l=current.letter||'a'; if(alphaToggle.checked){ l = step>0? nextLetter(l) : prevLetter(l); } let w = pickWordForLetter(l); if(!w){ for(let i=0;i<26;i++){ l = step>0? nextLetter(l) : prevLetter(l); w = pickWordForLetter(l); if(w) break; } } render(w||rand(getActiveFirstWordList()), { keepAnimal:false, keepName:false }); }
    function newDifferentLetterPhrase(){ const active = getActiveFirstWordList(); const cur = current.letter || 'a'; let w = null; if(alphaToggle.checked){ let l = nextLetter(cur); for(let i=0;i<26;i++){ w = pickWordForLetter(l); if(w) break; l = nextLetter(l);} } else { const pool = active.filter(x=> (x[0]||'') !== cur); w = pool.length ? rand(pool) : rand(active); } if(!w) w = rand(active); render(w, { keepAnimal:false, keepName:false }); }
    function newPhrase(){ newDifferentLetterPhrase(); }
    function newAnimal(){ if(!chkAnimal.checked) return; render(current.word,{ keepName:true }); }
    function newName(){ if(!chkName.checked) return; render(current.word,{ keepAnimal:true }); }

    // ======= LIST PAGES ====================================================
    function groupIdxForWord(w){ const f=w[0].toLowerCase(); if(f<'f') return 0; if(f<'k') return 1; if(f<'p') return 2; return 3; }
    function makeWordBtn(word){ const b=document.createElement('button'); b.className='btn small'; b.dataset.word=word; b.textContent=word[0].toUpperCase()+word.slice(1); return b; }
    function fillGrids(){ const activeWords = getActiveFirstWordList(); [grid12,gridFJ,gridKO,gridPZ].forEach(g=>g.innerHTML=''); activeWords.forEach(w=>{ const ix=groupIdxForWord(w); const btn=makeWordBtn(w); ([grid12,gridFJ,gridKO,gridPZ][ix]).appendChild(btn); }); }
    function onGridClick(e){ const b = e.target.closest('button.btn'); if(!b) return; const w=b.dataset.word; if(!w) return; render(w, { keepAnimal:false, keepName:false }); }
    grid12.addEventListener('click', onGridClick); gridFJ.addEventListener('click', onGridClick); gridKO.addEventListener('click', onGridClick); gridPZ.addEventListener('click', onGridClick);

    // ======= PAGE 1: search + suggestions ==================================
    function p1RenderSuggest(list, query){ p1Suggest.innerHTML=''; if(!list.length) { p1Index=-1; return; } const ul=document.createElement('ul'); list.slice(0,50).forEach((w,i)=>{ const li=document.createElement('li'); const first=query.length; const label=w[0].toUpperCase()+w.slice(1); li.innerHTML = `<strong>${label.slice(0,first)}</strong>${label.slice(first)}`; li.setAttribute('role','option'); li.setAttribute('aria-selected', String(i===p1Index)); li.addEventListener('mouseenter',()=>{ p1Index=i; updateP1Highlight(); }); li.addEventListener('click',()=>{ p1Index=i; chooseP1Index(); }); ul.appendChild(li); }); p1Suggest.appendChild(ul); }
    function updateP1Highlight(){ const items=p1Suggest.querySelectorAll('li'); items.forEach((li,i)=> li.setAttribute('aria-selected', String(i===p1Index))); }
    function chooseP1Index(){ if(p1Index<0 || p1Index>=p1List.length) return; const word=p1List[p1Index]; p1Suggest.innerHTML=''; p1Search.value=''; render(word,{keepAnimal:false,keepName:false}); }

    p1Search.addEventListener('input', e=>{ const q=e.target.value.trim().toLowerCase(); if(!q){ p1Suggest.innerHTML=''; return; } const newLetter=q[0]; if(newLetter!==current.letter){ render(q,{keepAnimal:false,keepName:false}); } else { render(q,{keepAnimal:true,keepName:true}); } const activeWords = getActiveFirstWordList(); p1List = activeWords.filter(w=>w.startsWith(q)); p1Index = p1List.length?0:-1; p1RenderSuggest(p1List,q); });
    p1Search.addEventListener('keydown', e=>{ const key=e.key; if(key==='ArrowDown'){ e.preventDefault(); if(!p1List.length) return; p1Index=(p1Index+1)%p1List.length; updateP1Highlight(); return; } if(key==='ArrowUp'){ e.preventDefault(); if(!p1List.length) return; p1Index=(p1Index-1+p1List.length)%p1List.length; updateP1Highlight(); return; } if(key==='Enter'){ e.preventDefault(); if(p1List.length && p1Index>=0){ chooseP1Index(); } else { newDifferentLetterPhrase(); } return; } if(key==='ArrowRight'){ e.preventDefault(); newPhraseAlpha(+1); return; } if(key==='ArrowLeft'){ e.preventDefault(); newPhraseAlpha(-1); return; } });

    // ======= Buttons & clicks ==============================================
    mainNewPhrase.addEventListener('click', newPhrase); mainNewAnimal.addEventListener('click', newAnimal); mainNewName.addEventListener('click', newName);
    enlargeBtn.addEventListener('click', ()=> document.body.classList.add('focus'));
    document.getElementById('minimizeBtn').addEventListener('click', ()=> document.body.classList.remove('focus'));
    document.getElementById('focusDefsBtn').addEventListener('click', ()=> defs.classList.add('open'));

    function openDefs(){ defs.classList.add('open'); updateDefs(); startDefsSequence(); }
    function closeDefs(){ defs.classList.remove('open'); }
    defsBtn.addEventListener('click', openDefs); defsBack.addEventListener('click', closeDefs);

    defsContent.addEventListener('click', (e)=>{ if(e.target.closest('.defsBottom, button')) return; newDifferentLetterPhrase(); startDefsSequence(); });

    result.addEventListener('click', ()=> { newDifferentLetterPhrase(); if(defs.classList.contains('open')) startDefsSequence(); });
    document.body.addEventListener('click', (e)=>{ if(e.target.closest('button, input, .sheet, .suggestions, .toggle, .output, .focusControls, .defs, .bottomArea')) return; newDifferentLetterPhrase(); if(defs.classList.contains('open')) startDefsSequence(); });

    // Bottom sheet controls
    let curPage = 0; function applyPage(){ pages.style.transform = `translateX(-${curPage*100}vw)`; tabs.forEach(t=>t.classList.remove('active')); const active = Array.from(tabs).find(t=>Number(t.dataset.ix)===curPage); if(active) active.classList.add('active'); }
    function openSheet(){ sheet.classList.add('open'); }
    function closeSheet(){ sheet.classList.remove('open'); }
    openSheetBtn.addEventListener('click', openSheet); closeSheetBtn.addEventListener('click', closeSheet);
    tabs.forEach(t=> t.addEventListener('click', ()=>{ curPage = Number(t.dataset.ix)||0; applyPage(); }));
    flipPrev.addEventListener('click', ()=>{ curPage = (curPage+3)%4; applyPage(); });
    flipNext.addEventListener('click', ()=>{ curPage = (curPage+1)%4; applyPage(); });
    document.addEventListener('keydown', e=>{ if(!sheet.classList.contains('open')) return; if(e.key==='ArrowRight'){ e.preventDefault(); flipNext.click(); } if(e.key==='ArrowLeft'){ e.preventDefault(); flipPrev.click(); } });

    // Gestures
    let startX=null, startY=null, handled=false; const H=35, V=60;
    window.addEventListener('pointerdown', e=>{ startX=e.clientX; startY=e.clientY; handled=false; }, {passive:false});
    window.addEventListener('pointermove', e=>{ if(startX===null) return; const dx=e.clientX-startX, dy=e.clientY-startY; const ax=Math.abs(dx), ay=Math.abs(dy); if(handled) { e.preventDefault(); return; } if(ax>H && ax>ay){ if(sheet.classList.contains('open')){ if(dx>0){ curPage=(curPage+3)%4; } else { curPage=(curPage+1)%4; } applyPage(); } else { if(dx>0){ document.body.classList.add('focus'); } else { document.body.classList.remove('focus'); } } handled=true; e.preventDefault(); return; } if(ay>V && ay>ax){ if(dy<0){ openSheet(); } else { if(sheet.classList.contains('open')) closeSheet(); } handled=true; e.preventDefault(); return; } }, {passive:false});
    window.addEventListener('pointerup', ()=>{ startX=null; startY=null; handled=false; }, {passive:false});

    // Auto-play & Settings
    function updatePlayButtons(){ playBtn.classList.toggle('active',playing); document.getElementById('focusPlayBtn').classList.toggle('active',playing); document.getElementById('focusPlayBtn').textContent = playing ? 'Stop' : 'Play'; defsPlayBtn && defsPlayBtn.classList.toggle('active', playing); defsPlayBtn && (defsPlayBtn.textContent = playing ? 'Stop' : 'Play'); }
    function scheduleNext(){ if(!playing) return; clearTimeout(timer); const delay = delayToggle.checked ? segSec : gapSec; timer=setTimeout(()=>{ newPhrase(); scheduleNext(); }, delay*1000); }
    function togglePlay(){ playing=!playing; updatePlayButtons(); if(playing) scheduleNext(); else clearTimeout(timer); }
    playBtn.addEventListener('click', togglePlay); document.getElementById('focusPlayBtn').addEventListener('click', togglePlay); defsPlayBtn.addEventListener('click', togglePlay);

    const settingsSheet = document.getElementById('settings');
    function toggleSettings(){ const open = settingsSheet.classList.toggle('open'); settingsBtn.classList.toggle('active', open); if(open) updateSettingsHighlights(); }
    settingsBtn.addEventListener('click', toggleSettings);
    settingsSheet.addEventListener('click', e=>{ if(e.target.id==='settings'){ settingsSheet.classList.remove('open'); settingsBtn.classList.remove('active'); }});
    document.getElementById('settingsCloseTop').addEventListener('click', ()=>{ settingsSheet.classList.remove('open'); settingsBtn.classList.remove('active'); });

    const wordGapButtons = () => Array.from(document.querySelectorAll('.setWordGap'));
    const segButtons     = () => Array.from(document.querySelectorAll('.setSeg'));
    const gapButtons     = () => Array.from(document.querySelectorAll('.setGap'));
    function updateSettingsHighlights(){ wordGapButtons().forEach(b=> b.classList.toggle('active', Number(b.dataset.v)===Number(wordDelay))); segButtons().forEach(b=> b.classList.toggle('active', Number(b.dataset.v)===Number(segSec))); gapButtons().forEach(b=> b.classList.toggle('active', Number(b.dataset.gap)===Number(gapSec))); updateToggleButtons(); }

    document.querySelectorAll('.setWordGap').forEach(b=> b.addEventListener('click', ()=>{ wordDelay = Number(b.dataset.v)||3; updateSettingsHighlights(); render(current.word,{ keepAnimal:true, keepName:true }); if(defs.classList.contains('open')) startDefsSequence(); }));
    document.querySelectorAll('.setSeg').forEach(b=> b.addEventListener('click', ()=>{ segSec = Number(b.dataset.v)||9; updateSettingsHighlights(); if(playing) scheduleNext(); if(defs.classList.contains('open')) startDefsSequence(); }));
    document.querySelectorAll('.setGap').forEach(b=> b.addEventListener('click', ()=>{ gapSec = Number(b.dataset.gap)||5; updateSettingsHighlights(); if(playing && !delayToggle.checked) scheduleNext(); }));

    delayToggle.addEventListener('change', ()=>{ updateSettingsHighlights(); render(current.word,{ keepAnimal:true, keepName:true }); if(playing) scheduleNext(); if(defs.classList.contains('open')) startDefsSequence(); });

    [chkEmotion, chkChem, chkMove].forEach(el=> el.addEventListener('change', ()=>{ fillGrids(); p1Suggest.innerHTML=''; }));
    [chkAnimal, chkName].forEach(el=> el.addEventListener('change', ()=>{ render(current.word,{ keepAnimal:true, keepName:true }); if(defs.classList.contains('open')) startDefsSequence(); }));
    phoneticToggle.addEventListener('change', ()=>{ phoneticOn=phoneticToggle.checked; render(current.word,{ keepAnimal:false, keepName:false }); if(defs.classList.contains('open')) startDefsSequence(); });
    chkIndian.addEventListener('change', ()=>{ indianOn = chkIndian.checked; render(current.word,{ keepAnimal:true, keepName:false }); if(defs.classList.contains('open')) startDefsSequence(); });

    // adv toggle affects chemistry + Indian names
    advToggle.addEventListener('change', ()=>{ if(!advToggle.checked){ chkChem.checked=false; chkIndian.checked=false; indianOn=false; } else { chkChem.checked=true; chkIndian.checked=true; indianOn=true; } fillGrids(); p1Suggest.innerHTML=''; render(current.word,{ keepAnimal:true, keepName:false }); if(defs.classList.contains('open')) startDefsSequence(); updateToggleButtons(); });

    // hide mode
    hideToggle.addEventListener('change', ()=>{ document.body.classList.toggle('hide', hideToggle.checked); updateToggleButtons(); });

    // Toggle buttons wiring
    function updateToggleButtons(){ btnABC.classList.toggle('active', alphaToggle.checked); btnAdv.classList.toggle('active', advToggle.checked); btnHide.classList.toggle('active', hideToggle.checked); }
    btnABC.addEventListener('click', ()=>{ alphaToggle.checked=!alphaToggle.checked; updateToggleButtons(); });
    btnAdv.addEventListener('click', ()=>{ advToggle.checked=!advToggle.checked; advToggle.dispatchEvent(new Event('change')); });
    btnHide.addEventListener('click', ()=>{ hideToggle.checked=!hideToggle.checked; hideToggle.dispatchEvent(new Event('change')); });

    // Audio
    function updateAudioUI(){ audioBtn.classList.toggle('active', audioOn); document.getElementById('focusAudioBtn').classList.toggle('active', audioOn); }
    function toggleAudio(){ audioOn=!audioOn; updateAudioUI(); if(!audioOn && 'speechSynthesis' in window) window.speechSynthesis.cancel(); }
    audioBtn.addEventListener('click', toggleAudio); document.getElementById('focusAudioBtn').addEventListener('click', toggleAudio);

    function updateAlphaUI(){ document.getElementById('focusAlphaBtn').classList.toggle('active', alphaToggle.checked); document.getElementById('focusAlphaBtn').textContent = 'ABC'; }
    document.getElementById('focusAlphaBtn').addEventListener('click', ()=>{ alphaToggle.checked=!alphaToggle.checked; updateAlphaUI(); updateToggleButtons(); });

    // Global PC shortcuts
    document.addEventListener('keydown', e=>{ if(document.activeElement===p1Search) return; if(e.key==='Enter'){ e.preventDefault(); newDifferentLetterPhrase(); } if(e.key==='ArrowRight'){ e.preventDefault(); newPhraseAlpha(+1); } if(e.key==='ArrowLeft'){ e.preventDefault(); newPhraseAlpha(-1); } });

    // Try fullscreen after first interaction
    let triedFS=false; function tryFS(){ if(triedFS) return; triedFS=true; const el=document.documentElement; const fn=el.requestFullscreen||el.webkitRequestFullscreen||el.msRequestFullscreen; if(fn) { try{ fn.call(el); }catch(e){} } }
    window.addEventListener('pointerdown', tryFS, { once:true });

    // Splash hide after 2.5s
    setTimeout(()=>{ splash.classList.add('hide'); }, 2500);

    // ======= Definitions logic =============================================
    function defForWord(w){ const s=(w||'').toLowerCase(); if(chemDefs[s]) return chemDefs[s]; if(animalDefs[s]) return animalDefs[s]; if(emotionList.includes(s)) return `a feeling of being ${s}.`; if(movementList.includes(s)) return `movement described as “${s}”.`; if(extraList.includes(s)) return `a descriptive quality: ${s}.`; return `a word meaning “${s}”.`; }

    function updateDefs(){ defWordLbl.textContent = current.word; defWordTxt.textContent = defForWord(current.word); defAnimalLbl.textContent = current.animal; defAnimalTxt.textContent = defForWord(current.animal); defNameLbl.textContent = current.name; defNameTxt.textContent = 'a personal name.'; }

    function showAllDefs(){ const cards = Array.from(document.querySelectorAll('.defCard')); cards.forEach((c,i)=>{ c.style.display = (i===0 || (i===1 && chkAnimal.checked) || (i===2 && chkName.checked)) ? 'block' : (i===0?'block':'none'); }); }

    let defsSeq = 0;
    function startDefsSequence(){
      [d2,d3].forEach(t=> clearTimeout(t)); defsSeq++; const mySeq = defsSeq;
      const cards = Array.from(document.querySelectorAll('.defCard'));
      if(!cards.length){ return; }
      const showAnimal = chkAnimal.checked; const showName = chkName.checked;
      // If Delay OFF or cadence too short to reveal all stages before next phrase, show everything at once.
      const requiredStages = (showAnimal?1:0) + (showName?1:0);
      const revealWindow = segSec; // first→first cadence
      const totalNeeded = (delayToggle.checked ? requiredStages * wordDelay : 0);
      if(!delayToggle.checked || totalNeeded >= revealWindow){ updateDefs(); showAllDefs(); return; }
      // Stage reveal reliably
      updateDefs();
      cards[0].style.display='block'; if(cards[1]) cards[1].style.display='none'; if(cards[2]) cards[2].style.display='none';
      if(showAnimal){ d2 = setTimeout(()=>{ if(defsSeq!==mySeq) return; if(cards[1]) cards[1].style.display='block'; }, wordDelay*1000); }
      if(showName){ const mul = showAnimal ? 2 : 1; d3 = setTimeout(()=>{ if(defsSeq!==mySeq) return; if(cards[2]) cards[2].style.display='block'; }, mul*wordDelay*1000); }
    }

    // Boot
    function boot(){ fillGrids(); updateAudioUI(); updateAlphaUI(); updateToggleButtons(); render('breathing', { keepAnimal:true, keepName:true }); updatePlayButtons(); scheduleNext(); }
    boot();
  </script>
</body>
</html>
